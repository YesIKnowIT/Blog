#
# This script is designed to be sourced by the root `blog` tool
#

YEAR=$(date +%Y)
TITLE="$1"
HANDLE=$(sed -E 's/[^a-z0-9]+/-/g'  <<< "${TITLE,,}")
BRANCH="$YEAR/$HANDLE"

if output=$(git status --porcelain) && [ -z "$output" ]; then
    git checkout --orphan "$BRANCH" || error 10
    git reset --hard
    rm -rf -- * .tools
    git merge tools

    mkdir -p -- "$BRANCH"
    (
        echo "# ${TITLE}"
    ) > "$BRANCH/article.adoc"
else 
    error 10 "Working director is not clean"
fi
